# SFTP Setup with Chroot
# Created by Biswadip Dutta


Create separate Group:
	groupadd sftpusers

Create new user, with no home directory and nologin shell belonging to the previously created group:
	useradd -g sftpusers -M -s /sbin/nologin newuser
	passwd newuser
	Verify: grep newuser /etc/passwd

Modify /etc/ssh/sshd_config:
	Comment out: Subsystem       sftp    /usr/libexec/openssh/sftp-server
	Put: Subsystem       sftp    internal-sftp

Specify Chroot directory for the group by appending to the /etc/ssh/sshd_config file:
	Match Group sftpusers
        ChrootDirectory /sftp/%u
        ForceCommand internal-sftp

	Tip: Also check if PasswordAuthentication is enabled. Try sentenforce 0 to fix "Couldn't get handle: Permission denied" on CentOS

Make chroot directories:
	mkdir /sftp ---> ownership: root:root
	mkdir /sftp/newuser ---> ownership: root:root
	mkdir /sftp/newuser/upload ---> ownership: newuser:sftpusers

Check sshd configuration proper on nor:
	sshd -t

Restart sshd:
	service sshd restart


For each new user:
==================
1. Create new user: 
	useradd -g sftpusers -M -s /sbin/nologin client-b
2. Create and change ownership of the chroot directory: 
	mkdir -p /sftp/client-b/upload
	chown client-b:sftpusers /sftp/client-b/upload
